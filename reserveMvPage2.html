<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="reserveMvP2Style.css">
  <title>영화 예매</title>
</head>

<body>
  <form id="info">
    <div class="black_box">HEART CINEMA</div>
    <fieldset>
      <legend>영화관 정보</legend>
      <hr>
      <table>
        <tbody>
          <tr>
            <td>영화관명</td>
            <td>Heart Cinema</td>
          </tr>
          <tr>
            <td>연락처</td>
            <td>010-0000-0000</td>
          </tr>
          <tr>
            <td>좌석수</td>
            <td>15</td>
          </tr>
        </tbody>
      </table>
    </fieldset>
    <fieldset>
      <legend>영화 정보</legend>
      <hr>
      <table>
        <tbody>
          <tr>
            <td>영화명</td>
            <td id="mvName"></td>
          </tr>
          <tr>
            <td>등급</td>
            <td id="rating"></td>
          </tr>
          <tr>
            <td>상영관</td>
            <td id="theater"></td>
          </tr>
          <tr>
            <td>상영시간</td>
            <td id="mvTime"></td>
          </tr>
        </tbody>
      </table>
    </fieldset>
  </form>
  <form>
    <fieldset id="day" class="right">
      <legend>일자선택</legend>
      <input type="date" id="date">
    </fieldset>

  </form>
  </fieldset>
  <fieldset id="pInfo" class="right">
    <legend>예약 정보 입력</legend>
    <hr>
    <table>
      <tbody>
        <tr>
          <td>성함</td>
          <td><input type="text" id="nameP"></td>
        </tr>
        <tr>
          <td>전화번호</td>
          <td>
            <form id="phone">
              <input type='tel' id='phone1' />-
              <input type='tel' id='phone2' />-
              <input type='tel' id='phone3' />
            </form>
          </td>
        </tr>

      </tbody>
    </table>
  </fieldset>
  </form>
  </fieldset>
  </form>
  <form>
    <br>
    <button type="button" onclick="reserveC();" id="closeButton" width="420px" style="cursor: pointer;">
      완료
    </button>
    <button type="button" onclick="prvPage();" id="slideButton" width="420px" style="cursor: pointer;">
      이전 단계
    </button>
  </form>
  <script>
    var ls = window.localStorage; // 로컬 스토리지
    var ss = window.sessonStorage; // 세션 스토리지
    var sheetId = sessionStorage.getItem("sheet");

    var mvName = new URLSearchParams(location.search).get("arg1");
    var rating = new URLSearchParams(location.search).get("arg2");
    var theater = new URLSearchParams(location.search).get("arg3");
    var mvTime = new URLSearchParams(location.search).get("arg4");
    var tblMvName = document.getElementById("mvName");
    var tblRating = document.getElementById("rating");
    var tblTheater = document.getElementById("theater");
    var tblMvTime = document.getElementById("mvTime");

    var date = document.getElementById("date");
    
    var pCount = window.sessionStorage.length - 1;

      function reserveC() {
        if (date.value >= new Date().toISOString().substring(0, 10)) {
          addItemLs();
          window.close()

        } else {
          alert("이미 지나버린 날입니다. 다른 날짜를 선택해 주십시오");
        }
        
      }
      
      //local storage
      if (!ls) {
        alert("로컬 스토리지를 지원하지 않습니다.");
      }
      /*function pageload() {
        
      }*/
      
      function addItemLs() {
        const nameP = document.getElementById('nameP').value;
        const phone1 = document.getElementById("phone1").value;
        const phone2 = document.getElementById("phone2").value;
        const phone3 = document.getElementById("phone3").value;
        const phone = phone1 + phone2 + phone3;
        var valueI = [nameP, sheetId, date.value, mvName, rating, theater, mvTime];
        ls.setItem(phone, valueI);
      }


      infoMovie();

      function infoMovie() {
        tblMvName.innerHTML = mvName;
        tblRating.innerHTML = rating;
        tblTheater.innerHTML = theater;
        tblMvTime.innerHTML = mvTime;
      }

      function prvPage(data) {
        args = "arg1=" + mvName + "&arg2=" + rating + "&arg3=" + theater + "&arg4=" + mvTime;
        window.location.href = "reserveMvPage.html?" + args;
      }
  </script>
</body>

</html>